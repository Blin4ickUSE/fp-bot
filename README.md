# 12VPN - Полная система управления VPN сервисом

Профессиональная система для управления VPN сервисом с интеграцией платежных систем, панелью управления и мини-приложением для Telegram.

## Структура проекта

```
.
├── backend/              # Backend модули
│   ├── api/             # API интеграции (Remnawave, Platega)
│   ├── database/        # Работа с базой данных
│   └── core/            # Основная логика и алгоритмы
├── src/                 # Боты
│   ├── bot/            # Основной бот
│   └── support_bot/    # Бот поддержки
├── miniapp/            # Мини-приложение Telegram (React)
├── panel/               # Панель управления (React)
├── docker-compose.yml   # Docker Compose конфигурация
├── install.sh          # Скрипт быстрой установки
└── .env                # Переменные окружения
```

## Быстрая установка

### Автоматическая установка (Ubuntu/Debian)

```bash
curl -sSL https://raw.githubusercontent.com/your-repo/main/install.sh | sudo bash
```

Скрипт автоматически:
- Проверит и установит все зависимости (Docker, Docker Compose, Nginx, Certbot)
- Настроит SSL сертификаты через Let's Encrypt
- Создаст конфигурацию Nginx
- Запустит все сервисы

### Ручная установка

1. **Клонируйте репозиторий:**
```bash
git clone https://github.com/your-repo/blinvpn.git
cd blinvpn
```

2. **Настройте .env файл:**
```bash
cp .env.example .env
nano .env
```

Заполните все необходимые данные:
- Токены Telegram ботов
- API ключи платежных систем
- Домены для сервисов
- Настройки Remnawave

3. **Запустите установку:**
```bash
sudo bash install.sh
```

Скрипт запросит:
- Домены для панели, мини-приложения и webhook'ов
- Email для SSL сертификатов
- Порты для сервисов

4. **Настройте DNS:**
Убедитесь, что домены указывают на IP вашего сервера:
- `A` запись для `panel.yourdomain.com`
- `A` запись для `app.yourdomain.com`
- `A` запись для `webhook.yourdomain.com`

## Функционал

### Основной бот
- Регистрация пользователей
- Реферальная система (20%)
- Проверка черного списка
- Интеграция с мини-приложением

### Бот поддержки (`@vpn12help_bot`)
- Принимает сообщения от пользователей в личку
- Создаёт **новую тему** в специальной группе-форуме (Telegram Forum) с информацией о пользователе (ID, имя, username) и текстом сообщения
- Любое сообщение, отправленное оператором **в эту тему**, автоматически пересылается пользователю в личку
- Повторные сообщения от того же пользователя дополняют существующую тему (один топик на пользователя)
- Для работы нужны в `.env`: `SUPPORT_BOT_TOKEN`, `SUPPORT_FORUM_GROUP_ID` (ID супергруппы с включёнными топиками). Бот должен быть администратором группы с правом «Управление топиками»

### Мини-приложение
- Пополнение баланса
- Покупка подписок
- Управление устройствами
- Реферальная программа
- Промокоды

### Панель управления
- Управление пользователями
- Управление ключами VPN
- Промокоды
- Рассылки
- Тикеты поддержки
- Статистика и аналитика

### Защита от злоупотреблений
- Максимум 1 устройство одновременно
- Лимит трафика 80 ГБ/сутки
- Автоматический бан при 3+ забаненных ключах
- Черный список с автообновлением

## API Endpoints

### Для мини-приложения:
- `GET /api/user/info?telegram_id={id}` - Информация о пользователе
- `POST /api/payment/create` - Создание платежа
- `POST /api/promocode/apply` - Применение промокода
- `POST /api/subscription/create` - Создание подписки

### Для панели (требует аутентификации):
- `GET /api/panel/users` - Список пользователей
- `GET /api/panel/promocodes` - Список промокодов
- `POST /api/panel/promocodes` - Создание промокода
- `POST /api/panel/mailing` - Отправка рассылки

## Webhook'и платежных систем

- `POST /platega` - Webhook от Platega

## Управление сервисами

```bash
# Запуск всех сервисов
docker-compose up -d

# Остановка
docker-compose down

# Просмотр логов
docker-compose logs -f

# Перезапуск конкретного сервиса
docker-compose restart bot
```

## База данных

База данных SQLite создается автоматически при первом запуске. Файл: `data.db`

Для резервного копирования:
```bash
cp data.db data.db.backup
```

## Безопасность

- Все API запросы от панели требуют Bearer токен
- Черный список обновляется автоматически каждые 60 минут
- Алгоритм защиты от злоупотреблений трафиком
- Проверка HWID для ограничения устройств

## Поддержка

При возникновении проблем:
1. Проверьте логи: `docker-compose logs`
2. Убедитесь, что все переменные в `.env` заполнены
3. Проверьте DNS настройки
4. Убедитесь, что порты открыты в firewall

## Лицензия

Proprietary - Все права защищены

